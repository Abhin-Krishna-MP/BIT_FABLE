<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Connection Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>Contract Connection Test</h1>
    <button id="connectBtn">Connect Wallet</button>
    <button id="testBtn" disabled>Test Contract</button>
    <div id="result"></div>

    <script>
        const CONTRACT_ADDRESS = '0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0';
        const CONTRACT_ABI = [
            "function isUserRegistered(address user) external view returns (bool)",
            "function setUser(string calldata _username) external",
            "function getUser(address userAddress) public view returns (string memory username, uint256 xp, uint256 level, uint256 achievements, uint256 dailyStreak, uint256 lastDailyCheck, uint256 powerUpsUsed, uint256 totalTasksCompleted, uint256 totalPhasesCompleted, uint256 ideasShared, uint256 upvotesGiven)"
        ];

        let provider, signer, contract;

        document.getElementById('connectBtn').addEventListener('click', async () => {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('MetaMask is not installed!');
                    return;
                }

                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                const address = await signer.getAddress();
                document.getElementById('result').innerHTML = `Connected: ${address}`;
                document.getElementById('testBtn').disabled = false;
                document.getElementById('connectBtn').disabled = true;
                
            } catch (error) {
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        });

        document.getElementById('testBtn').addEventListener('click', async () => {
            try {
                const address = await signer.getAddress();
                
                // Test isUserRegistered
                const isRegistered = await contract.isUserRegistered(address);
                document.getElementById('result').innerHTML = `
                    <p>Address: ${address}</p>
                    <p>Is Registered: ${isRegistered}</p>
                `;
                
                if (isRegistered) {
                    // Test getUser
                    const userData = await contract.getUser(address);
                    document.getElementById('result').innerHTML += `
                        <p>Username: ${userData[0]}</p>
                        <p>XP: ${userData[1].toString()}</p>
                        <p>Level: ${userData[2].toString()}</p>
                    `;
                }
                
            } catch (error) {
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html> 